% Palatino font:
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{palatino}

\usepackage{ragged2e}

%\usepackage{mathpazo}
\usepackage{newpxtext}
\usepackage{newpxmath}

\usepackage{upquote}

% front page
\usepackage[colorlinks]{hyperref} % for text color on title
\usepackage{titling} % makes \thetitle etc available...
\usepackage{lipsum}
\usepackage{tikz}
\tikzstyle{bag} = [align=center] % allows new lines in text below
\AtBeginDocument{\thispagestyle{empty}
\definecolor{titlecolor}{HTML}{1C2404}
\begin{tikzpicture}[remember picture,overlay]
\draw (current page.center) node[inner sep=0] {\resizebox{!}{350mm}{\includegraphics{highres_banner.pdf}}};
\draw (current page.center) node[inner sep=0, opacity=0.5] {\resizebox{!}{100mm}{\includegraphics{ausegl_sort.pdf}}};
% \draw (current page.center) node[bag] {  
        \draw (17, 1.7) node[bag, align=right, anchor=north east] {  
    % \mytitlefont 
    \color{titlecolor} \Large \textbf{Thesis} \\ 
    \\ 
    % \mytitlefont 
    \color{titlecolor} \Huge \textbf{\thetitle} \\ 
    \\ 
    % \mytitlefont
    \color{titlecolor} \huge \theauthor \\
    \\
    % \mytitlefont 
    \color{titlecolor} \Large \thedate 
    };
\end{tikzpicture}
\clearpage}

% back side
\AtEndDocument{\clearpage\thispagestyle{empty}
\begin{tikzpicture}[remember picture,overlay]
\draw (current page.center) node[inner sep=0] {\resizebox{!}{350mm}{\includegraphics{highres_banner.pdf}}};
% \draw (current page.center) node[bag] {  
    \draw (17, 1.7) node[bag, align=right, anchor=north east] {  
        % \mytitlefont 
        \color{titlecolor} \large Bioinformatics Research Centre \\ 
        % \mytitlefont 
        \color{titlecolor} \large Department of Molecular Biology and Genetics \\ 
        % \mytitlefont 
        \color{titlecolor} \large Aarhus University \\
        % \mytitlefont 
        \color{titlecolor} \large Universitetsbyen 81 \\
        % \mytitlefont 
        \color{titlecolor} \large 8000 Aarhus C \\
        % \mytitlefont 
        \color{titlecolor} \large Denmark
        };

\end{tikzpicture}}


% % picture (AU logo in title page)
% \usepackage{titlepic}
% % \usepackage{graphicx}
% \titlepic{\resizebox{!}{50mm}{\includegraphics[width=\textwidth]{ausegl_sort.pdf}}}



% \pagestyle{plain} % no running header

\usepackage[many]{tcolorbox}
\definecolor{quotegray}{HTML}{505050}
\newtcolorbox{myquote}{%
    enhanced jigsaw, 
    breakable,      % allow page breaks
    frame hidden,   % hide the default frame
    left=1cm,       % left margin
    right=1cm,      % right margin
    colback=white,
    fontupper=\color{quotegray},
    overlay={%
        \node [scale=4,
            text=lightgray,
            inner sep=0pt,] at ([xshift=0.5cm,yshift=-0.7cm]frame.north west){``}; 
        \node [scale=4,
            text=lightgray,
            inner sep=0pt,] at ([xshift=-0.5cm]frame.south east){''};  
            },
        % paragraph skips obeyed within tcolorbox
                parbox=false,
}
% redefine the 'quote' environment to use this 'myquote' environment
\renewenvironment{quote}{\begin{myquote}}{\end{myquote}}

% add a dummy abstract environment that is defined in quarto manuscript 
% but not in the quarto book that we run first to give it a slot in the 
% side bar
\ifcsmacro{abstract}{}{
  \let\endmyenvironment\undefined%
  \newenvironment{abstract}{\chapter*{Abstract}}{}
}

% \usepackage{framed} % not sure i need this anymore

% \usepackage[T1]{fontenc}
% \usepackage{inconsolata}

% % I have to only define Shaded if it is already defined.
% % The reason is that pandoc does not define the macro if there are not code blocks in the a markdown file.
% \ifx \@Shaded \@empty

% \renewcommand{\KeywordTok}[1]{\textcolor[rgb]{0, 0, 0}{\textbf{{#1}}}} % def and or not reg
% \renewcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.373, 0.298, 0.580}{\textbf{{#1}}}} % print open 
% \renewcommand{\VariableTok}[1]{\textcolor[rgb]{0.141, 0.392, 0.824}{\textbf{{#1}}}}
% \renewcommand{\OperatorTok}[1]{\textcolor[rgb]{0, 0, 0}{{#1}}} % def and or not reg
% \renewcommand{\DataTypeTok}[1]{\textcolor[rgb]{1.0,0.13,0.00}{{#1}}}
% \renewcommand{\DecValTok}[1]{\textcolor[rgb]{0.655, 0.498, 0.161}{{#1}}}
% \renewcommand{\BaseNTok}[1]{\textcolor[rgb]{0.259, 0.592, 0.596}{{#1}}}
% \renewcommand{\FloatTok}[1]{\textcolor[rgb]{0.655, 0.498, 0.161}{{#1}}}
% \renewcommand{\CharTok}[1]{\textcolor[rgb]{0.678,0.141,0.098}{{#1}}}
% \renewcommand{\StringTok}[1]{\textcolor[rgb]{0.678,0.141,0.098}{{#1}}}
% \renewcommand{\CommentTok}[1]{\textcolor[rgb]{0.135, 0.134, 0.133}{{#1}}}
% \renewcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
% \renewcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
% \renewcommand{\FunctionTok}[1]{\textcolor[rgb]{0.549, 0.102, 0.063}{\textbf{{#1}}}}  % function name
% \renewcommand{\RegionMarkerTok}[1]{{#1}}
% \renewcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
% \renewcommand{\NormalTok}[1]{\textcolor[rgb]{0, 0, 0}{{#1}}}


% \else
%   % no code blocks with markup...
% \fi

\usepackage{etoolbox}
\makeatletter
\g@addto@macro{\appendix}{%
  \patchcmd{\@@makechapterhead}% <cmd>
    {\endgraf\nobreak\vskip.5\baselineskip}% <search>
    {\hspace*{-.5em}:\space}% <replace>
    {}{}% <success><failure>
  \patchcmd{\@chapter}% <cmd>
    {\addchaptertocentry{\thechapter}}% <search>
    {\addchaptertocentry{Appendix~\thechapter:}}% <replace>
    {}{}% <success><failure>
  \addtocontents{toc}{%
    \protect\patchcmd{\protect\l@chapter}% <cmd>
      {1.5em}% <search>
      {6.5em}% <replace>
      {}{}}% <success><failure>
}
\renewcommand{\autodot}{}% Remove all end-of-counter dots
\makeatother


% restart chapter numbers in each part
\makeatletter
\@addtoreset{chapter}{part}
\makeatother


% \usepackage{chngcntr}
% \counterwithin*{subsubsection}{chapter}
% \counterwithout*{subsubsection}{section}
% \counterwithout*{subsubsection}{subsection}

% %  % KMT only use subsubsection number (this increments though the book 
% %  % when we supress numbering with  {.unnumbered} after each header except Exerisices
% \renewcommand\thesubsubsection{\arabic{section}}
% \renewcommand\thesubsubsection{\arabic{subsection}}
% \renewcommand\thesubsubsection{\arabic{chapter}-\arabic{subsubsection}}


\renewcommand*{\chapterformat}{%
\textcolor[rgb]{0.7, 0.7, 0.7}{\thechapter}\autodot\enskip%
}
\renewcommand*{\sectionformat}{%
\textcolor[rgb]{0.7, 0.7, 0.7}{\thesection}\autodot\enskip%
}
\renewcommand*{\subsectionformat}{%
\textcolor[rgb]{0.7, 0.7, 0.7}{\thesubsection}\autodot\enskip%
}
\renewcommand*{\subsubsectionformat}{%
\textcolor[rgb]{0.7, 0.7, 0.7}{\thesubsubsection}\autodot\enskip%
}



% % prevent latex from "floating" the figures
% \usepackage{float}
% \let\origfigure\figure
% \let\endorigfigure\endfigure
% \renewenvironment{figure}[1][2] {
%     \expandafter\origfigure\expandafter[H]
% } {
%     \endorigfigure
% }

\usepackage{xcolor}
\let\oldemph\emph
\renewcommand\emph[1]{\oldemph{\color{gray}#1}} % delete this line to make italics black again.



% \usepackage{parskip}
% \newlength{\currentparskip}
% \newenvironment{tableminipage}
%   {\setlength{\currentparskip}{\parskip}% save the value
%    \begin{minipage}{\textwidth}% open the minipage
%    \setlength{\parskip}{\currentparskip}% restore the value
%   }
%   {\end{minipage}}

% \usepackage{etoolbox}
% \AtBeginEnvironment{table}{\begin{tableminipage}}
% \AtEndEnvironment{table}{\end{tableminipage}}
% % \AtBeginEnvironment{tabular}{\tiny}

% \let\oldtabular\tabular
% \let\endoldtabular\endtabular
% \renewenvironment{tabular}{\bgroup\footnotesize\oldtabular}%
%                           {\endoldtabular\egroup}

% \let\oldlongtable\longtable
% \let\endoldlongtable\endlongtable
% \renewenvironment{longtable}{\footnotesize\oldlongtable}{\endoldlongtable} 

% \makeatletter
% \renewenvironment{table}{%
%   \if@tablecaptionabove\let\caption\captionabove
%   \else\let\caption\captionbelow\fi
%   \small\@float{table}%
% }{%
%   \end@float
% }
% \makeatother

% \usepackage{longtable}
% \makeatletter
% \renewenvironment{longtable}{%
%   \if@tablecaptionabove\let\caption\captionabove
%   \else\let\caption\captionbelow\fi
%   \small\@float{longtable}%
% }{%
%   \end@float
% }
% \makeatother



% \usepackage[font={footnotesize},labelfont={bf}]{caption}
% \AddToHook{env/longtable/before}{\fontsize{8}{10}\selectfont}
% \AddToHook{env/longtable/after}{\normalsize}
% \AddToHook{env/table/before}{\fontsize{8}{10}\selectfont}
% \AddToHook{env/table/after}{\normalsize}




%\captionsetup[table]{labelformat={empty}

% \let\oldlongtable\longtable
% \def\longtable{%
% \footnotesize
% \oldlongtable}


% \usepackage{longtable}
% \usepackage{caption}
% \captionsetup[table]{font={tiny}}

% \AddToHook{env/longtable/before}{\footnotesize}
% \AddToHook{env/longtable/after}{\normalsize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% %% from arcxiv.sty:  %%%
\RedeclareSectionCommand[
  beforeskip=-2ex,
  afterskip=1.5ex
]{chapter}

\RedeclareSectionCommand[
  beforeskip=-1.8ex,
  afterskip=0.8ex
]{section}

\RedeclareSectionCommand[
  beforeskip=--1.5ex,
  afterskip=0.5ex
]{subsection}

\RedeclareSectionCommand[
  beforeskip=1.5ex,
  afterskip=-1em
]{subsubsection}

\RedeclareSectionCommand[
  beforeskip=1.5ex,
  afterskip=-1em
]{paragraph}

% \RedeclareSectionCommand[
%   beforeskip=1.5ex plus 0.5ex minus 0.2ex,
%   afterskip=-1em
% ]{subparagraph}


% \setkomafont{section}{\normalfont\Large\bfseries\raggedright}
% \setkomafont{subsection}{\normalfont\large\bfseries\raggedright}
% \setkomafont{subsubsection}{\normalfont\normalsize\bfseries\raggedright}
% \setkomafont{paragraph}{\normalfont\normalsize\bfseries}
% \setkomafont{subparagraph}{\normalfont\normalsize\bfseries}

% \setkomafont{caption}{\small}
% \setkomafont{captionlabel}{\bfseries\sffamily}

%% Tables
% \usepackage[style=plaintop]{floatrow}
% \floatsetup[table]{capposition=top}
% \floatsetup[figure]{capposition=bottom}
% \floatsetup[table]{font=small}
% \usepackage{booktabs} % professional-quality tables (arxiv.sty)

\usepackage[font={footnotesize},labelfont={bf}]{caption}
\AddToHook{env/longtable/before}{\fontsize{8}{10}\selectfont}
\AddToHook{env/longtable/after}{\normalsize}
\AddToHook{env/table/before}{\fontsize{8}{10}\selectfont}
\AddToHook{env/table/after}{\normalsize}
\AddToHook{env/codelisting/before}{\fontsize{8}{10}\selectfont}
\AddToHook{env/codelisting/after}{\normalsize}

% \AddToHook{cmd/subcaption/before}{\vspace{-3mm}}
%\AddToHook{cmd/subcaption/after}{\vspace{-2cm}}


% \captionsetup[longtable]{font={footnotesize},labelfont={footnotesize}, position={top}, labelfont={bf}}
\captionsetup[sub]{font=footnotesize,labelfont=footnotesize, position=top}
\captionsetup[codelisting]{font=footnotesize, labelfont=bf}
% \captionsetup[subtable]{font=scriptsize,labelfont=scriptsize, position=top}

%\captionsetup[subfigure]{margin=150pt}

% \setlength\LTleft{0pt}
% \setlength\LTright{0pt}
% \begin{longtable}{@{\extracolsep{...}}...}

%\AddToHook{phantomsection/before}{\normalsize}
\AddToHook{phantomsection/after}{\normalsize}


%%% For code blocks using the Shaded environment
% \AddToHook{env/Shaded/before}{\vspace{-0.5em}\small} % Reduces space before
% \AddToHook{env/Shaded/after}{\vspace{-1em}} % Reduces space after
\definecolor{shadecolor}{RGB}{245,245,245}

\renewenvironment{Shaded}
{
  \vspace{-0.5em} % Add spacing before
  \begin{snugshade} % Begin shaded block
  \small % Smaller font
}
{
  \end{snugshade} % End shaded block
  \vspace{-1em} % Add spacing after
}
